<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Median Living Index - Real Purchasing Power Across America</title>
    <link rel="stylesheet" href="styles.css">
    <meta name="description" content="See which states let you save vs. spend more than you earn. Interactive map showing purchasing power across America.">
</head>
<body>
    <!-- Header -->
    <header>
        <div class="container">
            <h1>Median Living Index</h1>
            <p class="subtitle">Where Can Americans Actually Save Money?</p>
            <p class="tagline">Interactive map showing real purchasing power: Income √∑ Cost of Living</p>
        </div>
    </header>

    <!-- Quick Stats Banner -->
    <div class="stats-banner">
        <div class="container">
            <div class="stat-item">
                <span class="stat-number" id="surplusStates">--</span>
                <span class="stat-label">States with Surplus</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="breakEvenStates">--</span>
                <span class="stat-label">Breaking Even</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="deficitStates">--</span>
                <span class="stat-label">States in Deficit</span>
            </div>
            <div class="stat-item">
                <span class="stat-number" id="nationalMLI">--</span>
                <span class="stat-label">National Average MLI</span>
            </div>
        </div>
    </div>

    <!-- Main Content -->
    <main class="container">
        <!-- Introduction -->
        <section class="intro">
            <h2>How It Works</h2>
            <div class="explainer-grid">
                <div class="explainer-card">
                    <div class="explainer-icon">üìä</div>
                    <h3>The Formula</h3>
                    <p class="formula">MLI = Median Income √∑ Cost of Living</p>
                </div>
                <div class="explainer-card">
                    <div class="explainer-icon">‚öñÔ∏è</div>
                    <h3>Break Even Point</h3>
                    <p><strong>1.0 = Paycheck to Paycheck</strong><br>Income exactly covers annual expenses</p>
                </div>
                <div class="explainer-card">
                    <div class="explainer-icon">üí∞</div>
                    <h3>Above 1.0 = Surplus</h3>
                    <p><strong>1.3 = 30% Surplus</strong><br>Can save/invest 30% of income</p>
                </div>
                <div class="explainer-card">
                    <div class="explainer-icon">‚ö†Ô∏è</div>
                    <h3>Below 1.0 = Deficit</h3>
                    <p><strong>0.9 = 10% Deficit</strong><br>Spending 10% more than earning</p>
                </div>
            </div>
        </section>

        <!-- Interactive Map Section -->
        <section class="map-section">
            <h2>Interactive Map</h2>
            
            <div class="controls">
                <div class="control-group">
                    <label for="yearSlider">Year: <span id="yearDisplay">2023</span></label>
                    <input type="range" id="yearSlider" min="0" max="14" value="14" step="1">
                </div>
                <div class="control-group">
                    <label for="metricSelect">Show:</label>
                    <select id="metricSelect">
                        <option value="mli" selected>MLI Ratio</option>
                        <option value="surplus">Annual Surplus/Deficit</option>
                        <option value="income">Median Income</option>
                        <option value="col">Cost of Living</option>
                    </select>
                </div>
            </div>

            <div class="map-container">
                <svg id="map" width="960" height="600"></svg>
                <div id="tooltip" class="tooltip"></div>
            </div>

            <div class="legend">
                <div class="legend-title">MLI Scale</div>
                <div class="legend-gradient">
                    <span class="legend-label">0.8</span>
                    <div class="gradient-bar"></div>
                    <span class="legend-label">1.0</span>
                    <div class="gradient-bar"></div>
                    <span class="legend-label">1.5</span>
                </div>
                <div class="legend-labels">
                    <span>Deficit (Debt)</span>
                    <span>Break Even</span>
                    <span>Surplus (Savings)</span>
                </div>
            </div>
        </section>

        <!-- State Comparison Tool -->
        <section class="comparison-section">
            <h2>Compare Two States</h2>
            <div class="comparison-controls">
                <select id="compareState1" class="state-select">
                    <option value="">Select state 1...</option>
                </select>
                <span class="vs-text">vs</span>
                <select id="compareState2" class="state-select">
                    <option value="">Select state 2...</option>
                </select>
                <button id="compareBtn" class="compare-btn">Compare</button>
            </div>
            <div id="comparisonResult" class="comparison-result" style="display: none;"></div>
        </section>

        <!-- State Detail Panel -->
        <section class="detail-panel" id="detailPanel" style="display: none;">
            <div class="detail-header">
                <h2 id="stateName">Select a state</h2>
                <button id="closeDetail" class="close-btn">&times;</button>
            </div>
            
            <div class="detail-content">
                <div class="stat-cards">
                    <div class="stat-card">
                        <div class="stat-label">MLI Ratio</div>
                        <div class="stat-value" id="mliScore">--</div>
                        <div class="stat-rank" id="mliRank">--</div>
                        <div class="stat-interpretation" id="mliInterpretation">--</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Median Income</div>
                        <div class="stat-value" id="medianIncome">--</div>
                        <div class="stat-subtitle">Annual household income</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-label">Cost of Living</div>
                        <div class="stat-value" id="costOfLiving">--</div>
                        <div class="stat-subtitle">Annual expenses</div>
                    </div>
                    <div class="stat-card highlight-card">
                        <div class="stat-label">Annual Surplus/Deficit</div>
                        <div class="stat-value" id="annualSurplus">--</div>
                        <div class="stat-subtitle" id="surplusLabel">Available for savings</div>
                    </div>
                </div>

                <!-- Trend Chart -->
                <div class="chart-container">
                    <h3>MLI History (2008-2023)</h3>
                    <canvas id="trendChart"></canvas>
                    <div class="chart-insight" id="trendInsight"></div>
                </div>

                <!-- Cost Breakdown -->
                <div class="breakdown-container">
                    <h3>Where Your Money Goes (2023)</h3>
                    <div id="costBreakdown" class="cost-bars"></div>
                </div>
            </div>
        </section>

        <!-- Rankings Table -->
        <section class="rankings-section">
            <h2>State Rankings</h2>
            
            <div class="tab-controls">
                <button class="tab-btn active" data-tab="all">All States</button>
                <button class="tab-btn" data-tab="top10">Top 10 (Best)</button>
                <button class="tab-btn" data-tab="bottom10">Bottom 10 (Worst)</button>
            </div>

            <div class="table-controls">
                <input type="text" id="searchBox" placeholder="Search states..." class="search-box">
                <select id="sortSelect" class="sort-select">
                    <option value="mli-desc" selected>Highest MLI</option>
                    <option value="mli-asc">Lowest MLI</option>
                    <option value="name">Alphabetical</option>
                    <option value="surplus-desc">Highest Surplus</option>
                    <option value="income-desc">Highest Income</option>
                    <option value="col-asc">Lowest Cost</option>
                </select>
            </div>

            <div class="table-container">
                <table id="rankingsTable">
                    <thead>
                        <tr>
                            <th>Rank</th>
                            <th>State</th>
                            <th>MLI</th>
                            <th>Surplus/Deficit</th>
                            <th>Median Income</th>
                            <th>Cost of Living</th>
                            <th>15yr Change</th>
                        </tr>
                    </thead>
                    <tbody id="rankingsBody">
                        <!-- Populated by JavaScript -->
                    </tbody>
                </table>
            </div>
        </section>

        <!-- Insights Section -->
        <section class="insights-section">
            <h2>Key Insights</h2>
            <div class="insights-grid">
                <div class="insight-card">
                    <h3>üèÜ Best Purchasing Power</h3>
                    <div id="bestStates" class="insight-content"></div>
                </div>
                <div class="insight-card">
                    <h3>‚ö†Ô∏è Biggest Deficits</h3>
                    <div id="worstStates" class="insight-content"></div>
                </div>
                <div class="insight-card">
                    <h3>üìà Biggest Improvements</h3>
                    <div id="improvedStates" class="insight-content"></div>
                </div>
                <div class="insight-card">
                    <h3>üìâ Biggest Declines</h3>
                    <div id="declinedStates" class="insight-content"></div>
                </div>
            </div>
        </section>

        <!-- Methodology -->
        <section class="methodology">
            <h2>Methodology</h2>
            <div class="method-grid">
                <div class="method-card">
                    <h3>üìä Data Sources</h3>
                    <ul>
                        <li><strong>Income:</strong> US Census Bureau (ACS)</li>
                        <li><strong>Costs:</strong> BEA Regional Price Parities</li>
                        <li><strong>Spending:</strong> BLS Consumer Expenditure Survey</li>
                    </ul>
                </div>
                <div class="method-card">
                    <h3>üßÆ Calculation</h3>
                    <p><strong>MLI = Median Income √∑ Cost of Living</strong></p>
                    <p>Cost of Living includes 14 categories: housing, transportation, food, healthcare, and more, adjusted for state-specific price differences.</p>
                </div>
                <div class="method-card">
                    <h3>üí° Interpretation</h3>
                    <p><strong>MLI of 1.0</strong> means a median household's income exactly covers their annual expenses.</p>
                    <p><strong>Above 1.0:</strong> Surplus for savings/investment</p>
                    <p><strong>Below 1.0:</strong> Deficit (debt accumulation)</p>
                </div>
            </div>

            <div class="faq">
                <h3>Common Questions</h3>
                <details>
                    <summary>Why is this different from GDP or cost of living indices?</summary>
                    <p>GDP measures economic output, not what median households can actually afford. Traditional cost of living indices don't account for income. MLI shows the ratio between what people earn and what things cost‚Äîthe actual purchasing power of middle-class households.</p>
                </details>
                <details>
                    <summary>Can a state have high income but low MLI?</summary>
                    <p>Yes! California has median income of ~$85k but costs of ~$90k, resulting in MLI < 1.0. High income doesn't help if costs are even higher.</p>
                </details>
                <details>
                    <summary>What does "paycheck to paycheck" mean exactly?</summary>
                    <p>MLI = 1.0 means annual income equals annual expenses. No surplus for emergencies, savings, or investment. One unexpected expense creates debt.</p>
                </details>
            </div>
        </section>
    </main>

    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2026 Median Living Index | Data: Census Bureau, BEA, BLS</p>
            <p>Created by Cam Noval | <a href="https://github.com/camnoval/mli" target="_blank">View on GitHub</a></p>
        </div>
    </footer>

    <!-- Load D3.js for map -->
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <script src="https://d3js.org/topojson.v3.min.js"></script>
    
    <!-- Load Chart.js for trend charts -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.js"></script>
    
    <!-- Main application script -->
    <script src="app.js"></script>
</body>
</html>